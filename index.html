<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>SÃ©quence Saumur</title>
    <style>
        :root {
            --neon-gold: #fbc02d;
            --bg-dark: #0a0a0a;
            --cell-bg: #1a1a1a;
            --text-color: #e0e0e0;
            --success-green: #1b5e20;
        }

        body {
            background-color: var(--bg-dark);
            color: var(--text-color);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            display: flex; flex-direction: column; align-items: center;
            margin: 0; padding: 10px; min-height: 100vh; overflow-x: hidden;
            transition: background 2s ease;
        }

        body.night-mode {
            background: radial-gradient(circle at center, #001529 0%, #000814 100%);
        }

        #game-viewport {
            width: 100%; max-width: 500px;
            display: flex; flex-direction: column; gap: 5px;
            margin-top: 10px; padding-bottom: 160px;
        }

        .word-row { display: flex; justify-content: center; align-items: center; gap: 3px; }

        .cell {
            width: 32px; height: 32px; background: var(--cell-bg);
            border: 1px solid #333; border-radius: 4px;
            display: flex; align-items: center; justify-content: center;
            transition: all 0.5s ease;
        }

        .cell input {
            width: 100%; height: 100%; border: none; background: transparent;
            color: white; text-align: center; font-size: 1.1rem;
            font-weight: bold; text-transform: uppercase; outline: none;
        }

        .cell.target { border: 1px solid rgba(251, 192, 45, 0.5); }

        .row-solved .cell { background: var(--success-green); border-color: #2e7d32; }
        .row-solved .cell.target {
            background: var(--neon-gold) !important;
            border-color: white !important;
            box-shadow: 0 0 10px var(--neon-gold);
            z-index: 5;
        }
        .row-solved .cell.target input { color: black !important; }

        /* Animation Hint */
        @keyframes hint-blink {
            0%, 100% { background: var(--success-green); }
            50% { background: white; transform: scale(1.1); }
        }
        .hint-anim { animation: hint-blink 0.4s ease 2; }

        #clue-panel {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
            width: 85%; max-width: 400px; background: rgba(20, 20, 20, 0.95);
            border: 1px solid #333; padding: 15px; border-radius: 15px;
            backdrop-filter: blur(10px); text-align: center;
            border-bottom: 3px solid var(--neon-gold); z-index: 100;
        }

        #hint-btn {
            position: fixed; bottom: 130px; right: 20px;
            width: 55px; height: 55px; border-radius: 50%;
            background: #222; border: 2px solid var(--neon-gold);
            font-size: 1.6rem; display: flex; align-items: center; justify-content: center;
            cursor: pointer; z-index: 101;
            box-shadow: 0 0 15px rgba(251, 192, 45, 0.4);
            animation: pulse-gold 2s infinite;
        }

        @keyframes pulse-gold {
            0% { box-shadow: 0 0 0 0px rgba(251, 192, 45, 0.7); }
            70% { box-shadow: 0 0 0 15px rgba(251, 192, 45, 0); }
            100% { box-shadow: 0 0 0 0px rgba(251, 192, 45, 0); }
        }

        #hint-count {
            position: absolute; top: -5px; right: -5px;
            background: var(--neon-gold); color: black;
            font-size: 0.75rem; font-weight: bold;
            padding: 2px 7px; border-radius: 10px; border: 1px solid black;
        }

        .flying-letter {
            width: 36px; height: 36px; background: var(--neon-gold);
            color: black; font-weight: bold; display: flex;
            align-items: center; justify-content: center;
            border-radius: 4px; box-shadow: 0 0 20px var(--neon-gold);
            position: fixed; z-index: 9999; transition: all 1.5s cubic-bezier(0.19, 1, 0.22, 1);
        }

        .particle {
            position: fixed; background: var(--neon-gold);
            border-radius: 50%; pointer-events: none; z-index: 9998;
        }

        .destroyed { transform: translateY(120vh) rotate(540deg); opacity: 0; }
    </style>
</head>
<body>

    <div id="game-viewport"></div>
    <div id="hint-btn" onclick="giveHint()">ðŸ’¡ <span id="hint-count">10</span></div>
    <div id="clue-panel"><div id="clue-text">Appuyez sur une case pour l'indice</div></div>

<script>
    const targetPhrase = "ESPLANADE HUBERT LANDAIS";
    let hintsLeft = 10;
    let currentFocusedRow = null;

    const config = [
        { word: "SAUMUR",     targetIdx: 3, clue: "La perle de l'anjou ðŸŒ™" }, 
        { word: "CASSOS",     targetIdx: 2, clue: "Il y a en beaucoup a Saumur ðŸ¤ª" }, 
        { word: "ESPRIT",     targetIdx: 1, clue: "Partie immatÃ©rielle de l'Ãªtre." }, 
        { word: "ANGORA",     targetIdx: 0, clue: "EspÃ¨ce de chat cÃ©lÃ¨bre." }, 
        { word: "SAUVAGE",    targetIdx: 2, clue: "Qui n'est pas domestiquÃ©." }, 
        { word: "POISON",     targetIdx: 5, clue: "Substance toxique." }, 
        { word: "MURAILLE",   targetIdx: 4, clue: "Obstacle de pierre." }, 
        { word: "EVIDENCE",   targetIdx: 0, clue: "Ce qui s'impose Ã  l'esprit." }, 
        { word: "CHIMERE",    targetIdx: 1, clue: "CrÃ©ature mythologique." }, 
        { word: "SOUVENIR",   targetIdx: 1, clue: "Image du passÃ©." }, 
        { word: "OBSCUR",     targetIdx: 1, clue: "Qui manque de lumiÃ¨re." }, 
        { word: "REBELLE",    targetIdx: 0, clue: "Qui refuse l'autoritÃ©." }, 
        { word: "MISTRAL",    targetIdx: 3, clue: "Vent puissant du couloir rhodanien." }, 
        { word: "INSTINCT",   targetIdx: 3, clue: "Pulsion naturelle." }, 
        { word: "SILENCE",    targetIdx: 2, clue: "Absence de bruit." }, 
        { word: "ABYSSE",     targetIdx: 4, clue: "Profondeur immense." }, 
        { word: "SOUFRE",     targetIdx: 0, clue: "Element qui pue l Oeuf Pourri" }, 
        { word: "VENIMEUX",   targetIdx: 2, clue: "Se dit d'un serpent." }, 
        { word: "RELIQUE",    targetIdx: 0, clue: "Objet ayant appartenu Ã  un saint." }, 
        { word: "ECLIPSE",    targetIdx: 3, clue: "Disparition d'un astre." }, 
        { word: "RESINE",     targetIdx: 3, clue: "Substance des pins." },
        { word: "SANGUIN",    targetIdx: 0, clue: "TempÃ©rament vif ou couleur du sang." }
    ];

    const viewport = document.getElementById('game-viewport');
    const clueDisplay = document.getElementById('clue-text');
    let solvedCount = 0;

    config.forEach((data, rIdx) => {
        const row = document.createElement('div');
        row.className = 'word-row';
        row.dataset.answer = data.word.toUpperCase();
        for (let i = 0; i < data.word.length; i++) {
            const cell = document.createElement('div');
            cell.className = 'cell';
            if (i === data.targetIdx) cell.classList.add('target');
            const input = document.createElement('input');
            input.maxLength = 1;
            input.addEventListener('focus', () => { currentFocusedRow = row; clueDisplay.innerHTML = `<strong>Ligne ${rIdx + 1} :</strong><br>${data.clue}`; });
            input.addEventListener('input', (e) => { e.target.value = e.target.value.toUpperCase(); if (e.target.value) moveFocus(input, 1); checkRow(row); });
            input.addEventListener('keydown', (e) => { if (e.key === 'Backspace' && !input.value) moveFocus(input, -1); });
            cell.appendChild(input);
            row.appendChild(cell);
        }
        viewport.appendChild(row);
    });

    function moveFocus(input, dir) {
        const inputs = Array.from(input.closest('.word-row').querySelectorAll('input'));
        const idx = inputs.indexOf(input);
        if (inputs[idx + dir]) inputs[idx + dir].focus();
    }

    function checkRow(row) {
        if (row.classList.contains('row-solved')) return;
        const inputs = Array.from(row.querySelectorAll('input'));
        const val = inputs.map(i => i.value).join('');
        if (val === row.dataset.answer) {
            row.classList.add('row-solved');
            inputs.forEach(i => i.readOnly = true);
            solvedCount++;
            if (solvedCount === config.length) setTimeout(celebrate, 800);
        }
    }

    function giveHint() {
        if (hintsLeft <= 0 || !currentFocusedRow || currentFocusedRow.classList.contains('row-solved')) return;
        const cells = Array.from(currentFocusedRow.querySelectorAll('.cell'));
        const emptyIndices = cells.map((c, i) => (c.querySelector('input').value.toUpperCase() !== currentFocusedRow.dataset.answer[i] && !c.classList.contains('target')) ? i : null).filter(n => n !== null);
        if (emptyIndices.length > 0) {
            const randIdx = emptyIndices[Math.floor(Math.random() * emptyIndices.length)];
            const cell = cells[randIdx];
            const inp = cell.querySelector('input');
            cell.classList.add('hint-anim');
            setTimeout(() => { inp.value = currentFocusedRow.dataset.answer[randIdx]; checkRow(currentFocusedRow); cell.classList.remove('hint-anim'); }, 800);
            hintsLeft--;
            document.getElementById('hint-count').innerText = hintsLeft;
            if(navigator.vibrate) navigator.vibrate(20);
        }
    }

    function celebrate() {
        document.body.classList.add('night-mode');
        document.getElementById('clue-panel').style.opacity = "0";
        document.getElementById('hint-btn').style.display = "none";
        
        document.querySelectorAll('.cell:not(.target)').forEach((cell, i) => {
            setTimeout(() => { cell.classList.add('destroyed'); createParticle(cell); }, i * 20);
        });

        const targetCells = Array.from(document.querySelectorAll('.cell.target'));
        const cleanPhrase = targetPhrase.replace(/\s/g, '');

        targetCells.forEach((cell, index) => {
            const rect = cell.getBoundingClientRect();
            const letter = document.createElement('div');
            letter.className = 'flying-letter';
            letter.innerText = cleanPhrase[index];
            letter.style.left = rect.left + 'px';
            letter.style.top = rect.top + 'px';
            document.body.appendChild(letter);
            cell.style.opacity = "0";

            setTimeout(() => {
                const rows = [{start: 0, len: 9, y: 30}, {start: 9, len: 6, y: 45}, {start: 15, len: 7, y: 60}];
                const p = rows.find(r => index >= r.start && index < r.start + r.len);
                const colIdx = index - p.start;
                const totalW = p.len * 42;
                letter.style.left = `calc(50% - ${totalW/2}px + ${colIdx * 42}px)`;
                letter.style.top = p.y + '%';
            }, 500 + (index * 60));
        });
    }

    function createParticle(el) {
        const rect = el.getBoundingClientRect();
        for(let i=0; i<3; i++) {
            const p = document.createElement('div');
            p.className = 'particle';
            const size = Math.random() * 4 + 2;
            p.style.width = size + 'px'; p.style.height = size + 'px';
            p.style.left = rect.left + rect.width/2 + 'px';
            p.style.top = rect.top + rect.height/2 + 'px';
            document.body.appendChild(p);
            const angle = Math.random() * Math.PI * 2;
            const velocity = Math.random() * 100 + 50;
            p.animate([
                { transform: 'translate(0,0) scale(1)', opacity: 1 },
                { transform: `translate(${Math.cos(angle)*velocity}px, ${Math.sin(angle)*velocity}px) scale(0)`, opacity: 0 }
            ], { duration: 1000 + Math.random()*1000, easing: 'out-cubic' }).onfinish = () => p.remove();
        }
    }
</script>
</body>
</html>
